pipeline {
  agent any
  options {
    lock resource: 'htmlunit-test-ports'
    disableConcurrentBuilds()
    timestamps()
    timeout(time: 30, unit: 'MINUTES')
  }
  stages {
    stage('Build') {
      steps {
        sh 'java -version'
        sh 'mvn clean test -P only-huge-tests-d-g --show-version -Dgpg.skip -Djava.awt.headless=true'
      }
    }
  }
  post {
    always {
      node('') {
        junit allowEmptyResults: true, testResults: 'target/surefire-reports/**/*.xml'
        recordIssues enabledForFailure: true, sourceCodeEncoding: 'UTF-8', tools: [java()]
        step([$class: 'Mailer',
          notifyEveryUnstableBuild: true,
          recipients: "rbri@rbri.de"])
      }
    }
  }
}