pipeline {
  agent any
  options {
    lock resource: 'htmlunit-test-ports'
    disableConcurrentBuilds()
    timestamps()
    timeout(time: 6, unit: 'HOURS')
  }
  tools {
    jdk 'openlogic-openjdk-17.0.17+10'
  }
  stages {
    stage('Build') {
      steps {
        sh 'mvn clean test -U -P only-library-tests --show-version -Dgpg.skip -Djava.awt.headless=true'
      }
    }
  }
  post {
    always {
      node('') {
        junit allowEmptyResults: true, testResults: 'target/surefire-reports/**/*.xml'
        recordIssues enabledForFailure: true, sourceCodeEncoding: 'UTF-8', tools: [java()]
        step([$class: 'Mailer',
          notifyEveryUnstableBuild: true,
          recipients: "rbri@rbri.de"])
      }
    }
  }
}